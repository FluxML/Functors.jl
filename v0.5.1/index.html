<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Home · Functors.jl</title><meta name="title" content="Home · Functors.jl"/><meta property="og:title" content="Home · Functors.jl"/><meta property="twitter:title" content="Home · Functors.jl"/><meta name="description" content="Documentation for Functors.jl."/><meta property="og:description" content="Documentation for Functors.jl."/><meta property="twitter:description" content="Documentation for Functors.jl."/><script async src="https://www.googletagmanager.com/gtag/js?id=UA-36890222-9"></script><script>  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-36890222-9', {'page_path': location.pathname + location.search + location.hash});
</script><script data-outdated-warner src="assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="assets/documenter.js"></script><script src="search_index.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="assets/themeswap.js"></script><link href="assets/flux.css" rel="stylesheet" type="text/css"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href><img src="assets/logo.png" alt="Functors.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href>Functors.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li class="is-active"><a class="tocitem" href>Home</a><ul class="internal"><li><a class="tocitem" href="#Basic-Usage-and-Implementation"><span>Basic Usage and Implementation</span></a></li><li><a class="tocitem" href="#Which-types-are-leaves?"><span>Which types are leaves?</span></a></li><li><a class="tocitem" href="#What-if-I-get-an-error?"><span>What if I get an error?</span></a></li></ul></li><li><a class="tocitem" href="api/">API</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Home</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Home</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/FluxML/Functors.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/FluxML/Functors.jl/blob/master/docs/src/index.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Functors.jl"><a class="docs-heading-anchor" href="#Functors.jl">Functors.jl</a><a id="Functors.jl-1"></a><a class="docs-heading-anchor-permalink" href="#Functors.jl" title="Permalink"></a></h1><p>Functors.jl provides a set of tools to represent <a href="https://en.wikipedia.org/wiki/Functor_(functional_programming)">functors</a>. Functors are a powerful means to apply functions to generic objects without changing their structure.</p><p>The most straightforward use is to traverse a complicated nested structure as a tree, and apply a function <code>f</code> to every field it encounters along the way.</p><p>For large machine learning models it can be cumbersome or inefficient to work with parameters as one big, flat vector, and structs help manage complexity; but it may be desirable to easily operate over all parameters at once, e.g. for changing precision or applying an optimiser update step.</p><h2 id="Basic-Usage-and-Implementation"><a class="docs-heading-anchor" href="#Basic-Usage-and-Implementation">Basic Usage and Implementation</a><a id="Basic-Usage-and-Implementation-1"></a><a class="docs-heading-anchor-permalink" href="#Basic-Usage-and-Implementation" title="Permalink"></a></h2><p>By default, Functors.jl is allowed to look into the fields of the instances of any struct and modify them. This can be achieved through <a href="api/#Functors.fmap"><code>fmap</code></a>. To opt-out of this behaviour and mark a custom type as non traversable, use the macro <a href="api/#Functors.@leaf"><code>@leaf</code></a>.</p><p>The workhorse of <code>fmap</code> is actually a lower level function, <a href="api/#Functors.functor"><code>functor</code></a>:</p><pre><code class="language-julia-repl hljs">julia&gt; using Functors

julia&gt; struct Foo
         x
         y
       end

julia&gt; foo = Foo(1, [1, 2, 3]) # notice all the elements are integers

julia&gt; xs, re = Functors.functor(foo)
((x = 1, y = [1, 2, 3]), var&quot;#21#22&quot;())

julia&gt; re(map(float, xs)) # element types have been switched out for floating point numbers
Foo(1.0, [1.0, 2.0, 3.0])</code></pre><p><code>functor</code> returns the parts of the object that can be inspected, as well as a reconstruction function (shown as <code>re</code>) that takes those values and restructures them back into an object of the original type.</p><p>To include only certain fields of a struct, one can pass a tuple of field names to <a href="api/#Functors.@functor"><code>@functor</code></a>:</p><pre><code class="language-julia-repl hljs">julia&gt; struct Baz
         x
         y
       end

julia&gt; @functor Baz (x,)

julia&gt; model = Baz(1, 2)
Baz(1, 2)

julia&gt; fmap(float, model)
Baz(1.0, 2)</code></pre><p>Any field not in the list will be passed through as-is during reconstruction. This is done by invoking the default constructor accepting all fields as arguments, so structs that define custom inner constructors are expected to provide one that acts like the default. </p><p>The use of <code>@functor</code> with no fields argument as in <code>@functor Baz</code> is equivalent to <code>@functor Baz fieldnames(Baz)</code> and also equivalent to avoiding <code>@functor</code> altogether.</p><p>Using <a href="api/#Functors.@leaf"><code>@leaf</code></a> instead of <a href="api/#Functors.@functor"><code>@functor</code></a> will prevent the fields of a struct from being traversed.</p><div class="admonition is-warning"><header class="admonition-header">Change to opt-out behaviour in v0.5</header><div class="admonition-body"><p>Previous releases of functors, up to v0.4, used an opt-in behaviour where structs were leaves functors unless marked with <code>@functor</code>. This was changed in v0.5 to an opt-out behaviour where structs are functors unless marked with <code>@leaf</code>.</p></div></div><h2 id="Which-types-are-leaves?"><a class="docs-heading-anchor" href="#Which-types-are-leaves?">Which types are leaves?</a><a id="Which-types-are-leaves?-1"></a><a class="docs-heading-anchor-permalink" href="#Which-types-are-leaves?" title="Permalink"></a></h2><p>By default all composite types in are functors and can be traversed, unless marked with <a href="api/#Functors.@leaf"><code>@leaf</code></a>. </p><p>The following types instead are explicitly marked as leaves in Functors.jl:</p><ul><li><code>Type</code></li><li><code>Number</code>.</li><li><code>AbstractArray{&lt;:Number}</code>, except for the wrappers <code>Transpose</code>, <code>Adjoint</code>, and <code>PermutedDimsArray</code>.</li><li><code>AbstractRNG</code>.</li><li><code>AbstractString</code>, <code>AbstractChar</code>, <code>AbstractPattern</code>, <code>AbstractMatch</code>.</li></ul><p>This is because in typical application the internals of these are abstracted away and it is not desirable to traverse them.</p><h2 id="What-if-I-get-an-error?"><a class="docs-heading-anchor" href="#What-if-I-get-an-error?">What if I get an error?</a><a id="What-if-I-get-an-error?-1"></a><a class="docs-heading-anchor-permalink" href="#What-if-I-get-an-error?" title="Permalink"></a></h2><p>Since by default Functors.jl tries to traverse most types e.g. when using <a href="api/#Functors.fmap"><code>fmap</code></a>, it is possible it fails in case the type has not an appropriate constructor. If use experience this issue, you have a few alternatives:</p><ul><li>Mark the type as a leaf using <a href="api/#Functors.@leaf"><code>@leaf</code></a> </li><li>Use the <code>@functor</code> macro to specify which fields to traverse.</li><li>Define an appropriate constructor for the type.</li></ul><p>If you are not able to traverse types in julia Base, please open an issue.</p></article><nav class="docs-footer"><a class="docs-footer-nextpage" href="api/">API »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.7.0 on <span class="colophon-date" title="Thursday 7 November 2024 06:05">Thursday 7 November 2024</span>. Using Julia version 1.10.6.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
